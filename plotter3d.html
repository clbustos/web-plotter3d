<html>
<head>
<title>Plotter 3d</title>
<link type="text/css" href="css/ui-lightness/jquery-ui-1.8.16.custom.css" rel="stylesheet" />	
<script type="text/javascript" src="js/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.16.custom.min.js"></script>

<script src="js/sylvester.js" ></script>
<script>
var traslator={
  scale:10,
  width:250,
  height:250,
  pos: function(x,y) {
    return [x*this.scale+this.width/2, y*this.scale+this.height/2]
  }
}
var mdata=null;
var mtrans=null
var m2=null
function chomp(raw_text)
{
  return raw_text.replace(/(\n|\r)+$/, '');
}
function draw(){
  var canvas = document.getElementById("c1");
    if (canvas.getContext){
      var ctx = canvas.getContext('2d');
      }
ctx.clearRect(0,0,250,250)
// Obtener las matrices
data=chomp($('#data').val()).split("\n").map(function(v) {
  return v.split(",");
  })

conv=chomp($('#conv').val()).split("\n").map(function(v) {
  return v.split(",");
  })
//a=document.getElementById("a").value+0
//b=document.getElementById("b").value+0
var a = ($( "#sa" ).slider( "option", "value" )+0)*2*Math.PI/100;
var b = ($( "#sb" ).slider( "option", "value" )+0)*2*Math.PI/100;

mdata=$M(data)
mtransorto=$M(conv)

m3=mdata.elements


mrot1=$M([
[1,0,0],
[0,Math.cos(a),Math.sin(a)],
[0,-Math.sin(a),Math.cos(a)]
])
mrot2=$M([
[Math.cos(b),0,-Math.sin(b)],
[0,1,0],
[Math.sin(b),0,Math.cos(b)]
])

m3rotado=(mrot1.x(mrot2).x(mdata.transpose())).transpose()
m2=m3rotado.x(mtransorto);
m2e=m2.elements


for(i=0;i<m2e.length;i++) {
  ctx.beginPath();
  ctx.fillStyle="rgb(0,0,"+m3[i][2]*50+")"
  pos=traslator.pos(m2e[i][0],m2e[i][1])
  ctx.arc(pos[0], pos[1], 3, 0, 2*Math.PI, false)
  ctx.fill()
}
}

$(function() {
    $( "#sa" ).slider({value:33, change:function(ev,ui){draw()}});
    $( "#sb" ).slider({value:50, change:function(ev,ui){draw()}});
    		draw();

	});


</script>
<style type="text/css">
      canvas { border: 2px solid black; }
    </style>
</head>
<body>
<h1>3d Plotter</h1>
<p>By clbustos ( <a href='https://github.com/clbustos/web-plotter3d'>github</a>)</p>
<div style="float:left"><canvas id="c1" width="250" height="250"></canvas></div>
<div style="float:left">
<textarea name="data" id="data" rows="15" cols="10">
0,0,0
1,0,0
2,0,0
0,1,0
1,1,0
2,1,0
0,2,0
1,2,0
2,2,0
0,0,2
1,0,2
2,0,2
0,1,2
1,1,2
2,1,2
0,2,2
1,2,2
2,2,2
0,0,4
1,0,4
2,0,4
0,1,4
1,1,4
2,1,4
0,2,4
1,2,4
2,2,4
</textarea>
</div>
<div style="float:left">
<textarea name="conv" id="conv" rows="3" cols="4">
1,0
0,1
0,0
</textarea>
<div>a:<div id="sa"></div></div>
<div>b:<div id="sb"></div></div>
<input type="button" value="Refresh" onclick="draw()" />

</div>
</html>
